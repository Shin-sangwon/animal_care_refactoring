<html layout:decorate="~{global/layout}">
<div class="container my-5" layout:fragment="content">
    <nav>
        <a th:href="@{/usr/doctor/mypage}" class="btn">뒤로</a>
    </nav>
    <h2 class="p-4">
        병원 관리
    </h2>
    <nav>
        <a class="btn btn-primary" th:href="@{/usr/doctor/mypage/hospital/modify}"
           th:text="수정"></a>
    </nav>
    <h4>병원 정보</h4>
    <nav>

    </nav>
    <div>
        <table class="table">
            <tbody>
            <tr>
                <th class="col-4">이름</th>
                <td th:text="${hospital.name}"></td>
            </tr>
            <tr>
                <th>전화 번호</th>
                <td th:text="${hospital.phoneNum}"></td>
            </tr>
            <tr>
                <th>주소</th>
                <td>
                    <p th:text="${'(우편번호) ' + hospital.zipcode}"></p>
                    <p th:text="${'(도로명 주소) ' +hospital.street + ' ' + hospital.detail}"></p>
                    <input type="hidden" name="street" id="street" th:value="${hospital.street}">
                    <p th:if="${!hospital.city.isBlank()}" th:text="${'(지번 주소) ' +hospital.city + ' ' + hospital.detail}"></p>
                    <div class="mb-3" id="map" style="width:100%;height:350px;"></div>
                </td>
            </tr>
            <tr>
                <th>영업 시간</th>
                <th>
                    <table class="table">
                        <tr>
                            <th>월요일</th>
                            <td th:if="${OpeningHours.getMonEnd()}" th:text="|${OpeningHours.monStart} ~ ${OpeningHours.monEnd}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>화요일</th>
                            <td th:if="${OpeningHours.getTueEnd()}" th:text="|${OpeningHours.getTueStart()} ~ ${OpeningHours.getTueEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>수요일</th>
                            <td th:if="${OpeningHours.getWedEnd()}" th:text="|${OpeningHours.getWedStart()} ~ ${OpeningHours.getWedEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>목요일</th>
                            <td th:if="${OpeningHours.getThuEnd()}" th:text="|${OpeningHours.getThuStart()} ~ ${OpeningHours.getThuEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>금요일</th>
                            <td th:if="${OpeningHours.getFriEnd()}" th:text="|${OpeningHours.getFriStart()} ~ ${OpeningHours.getFriEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>토요일</th>
                            <td th:if="${OpeningHours.getSatEnd()}" th:text="|${OpeningHours.getSatStart()} ~ ${OpeningHours.getSatEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                        <tr>
                            <th>일요일</th>
                            <td th:if="${OpeningHours.getSunEnd()}" th:text="|${OpeningHours.getSunStart()} ~ ${OpeningHours.getSunEnd()}|"></td>
                            <td th:unless="${OpeningHours.getMonEnd()}">휴무 요일</td>
                        </tr>
                    </table>
                </th>
            </tr>
            <tr>
                <th>등록 날짜</th>
                <td th:text="${#temporals.format(hospital.getCreatedAt(), 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr>
                <th>수정 날짜</th>
                <td th:text="${#temporals.format(hospital.getUpdatedAt(), 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            </tbody>
        </table>
        <br>
        <h4>의사 정보</h4>
        <div class="container">
            <div class="row">
                <div class="col-xl-4 col-md-6 col-sm-12 " th:each="doctor, i : ${hospital.getDoctorList()}">
                    <div class="card">
                        <div class="card-header" th:text="${doctor.name}"></div>
                        <div class="card-body">
                            <div style="height: 300px; text-align: center ">
                                <img src="https://picsum.photos/200/300">
                            </div>
                            <table class="table" >
                                <tbody>
                                <tr>
                                    <th>이메일</th>
                                    <td class="col-8" th:text="${doctor.email}"></td>
                                </tr>
                                <tr>
                                    <th>생년월일</th>
                                    <td th:text="${doctor.getBirthday()}"></td>
                                </tr>
                                <tr>
                                    <th>전공</th>
                                    <td th:text="${doctor.getMajor()}"></td>
                                </tr>
                                <tr>
                                    <th>핸드폰 번호</th>
                                    <td th:text="${doctor.getPhoneNum()}"></td>
                                </tr>
                                <tr>
                                    <th>성별</th>
                                    <td th:text="${doctor.getGenderId() == 0 ? '여' : '남'}"></td>
                                </tr>
                                <tr>
                                    <th>자기 소개</th>
                                    <td th:text="${doctor.getIntroduce()}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--TODO appkey 비밀키 사용  -->
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e11ec606a9ab5e56f6fcdae9c805b669&libraries=services"></script>
        <script>
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            // 지도를 생성합니다
            var map = new kakao.maps.Map(mapContainer, mapOption);

            var ps = new kakao.maps.services.Places();

            // 주소-좌표 변환 객체를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();
            // 주소로 좌표를 검색합니다
            updatePlace();

            function updatePlace(){
                const street = document.getElementById('street').value;
                console.log('updatePlace');
                console.log(street);
                geocoder.addressSearch(street, function(result, status) {

                    // 정상적으로 검색이 완료됐으면
                    if (status === kakao.maps.services.Status.OK) {

                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                        // 결과값으로 받은 위치를 마커로 표시합니다
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: coords
                        });

                        // 인포윈도우로 장소에 대한 설명을 표시합니다
                        var infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="width:150px;text-align:center;padding:6px 0;">병원</div>'
                        });
                        infowindow.open(map, marker);

                        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                        map.setCenter(coords);
                    }
                });
            }
        </script>
    </div>
</div>
</html>